# 牛データ一括登録マニュアル

## 概要
CowTrackアプリケーションで牛のデータをまとめて登録する方法を説明します。

## 方法1: Django管理画面でのCSVインポート

### 手順
1. Django管理画面にログイン
2. 「牛」セクションに移動
3. 「CSVインポート」リンクをクリック
4. CSVファイルを選択してアップロード
5. 「CSVファイルをインポート」ボタンをクリック

### CSVファイル形式
以下の列を含むCSVファイルを準備してください：

| 列名 | 説明 | 必須 | デフォルト値 |
|------|------|------|-------------|
| cow_number | 牛個体識別番号（10桁） | ○ | - |
| shed_code | 牛舎番号 | ○ | - |
| intake_date | 導入日（YYYY-MM-DD形式） | ○ | - |
| gender | 性別 | × | female（メス） |
| origin_region | 導入元地域 | × | 自家 |
| status | ステータス | × | active |

### 性別の選択肢
- `female`: メス
- `castrated`: 去勢

### 導入元地域の選択肢
- `北海道`: 北海道
- `曽於`: 曽於
- `関`: 関
- `飛騨`: 飛騨
- `自家`: 自家

### ステータスの選択肢
- `active`: 在籍中
- `moved`: 移動済み
- `sold`: 売却済み
- `dead`: 死亡

## 方法2: Django管理コマンドでの一括登録

### 基本的な使用方法
```bash
python manage.py import_cows sample_cows.csv
```

### オプション付きの使用方法

#### 既存データの更新も含める
```bash
python manage.py import_cows sample_cows.csv --update
```

#### ドライラン（実際には保存しない）
```bash
python manage.py import_cows sample_cows.csv --dry-run
```

#### 更新とドライランを組み合わせ
```bash
python manage.py import_cows sample_cows.csv --update --dry-run
```

### コマンドの説明
- `sample_cows.csv`: インポートするCSVファイルのパス
- `--update`: 既存の牛番号がある場合、データを更新する
- `--dry-run`: 実際にはデータベースに保存せず、処理内容のみ表示

## 方法3: プログラムでの一括登録

### Pythonスクリプトでの一括登録例

```python
from cattle.models import Cow
from datetime import date

# 牛データのリスト
cows_data = [
    {
        'cow_number': '1234567890',
        'shed_code': 'A001',
        'intake_date': date(2024, 1, 15),
        'gender': 'female',
        'origin_region': '北海道',
        'status': 'active'
    },
    {
        'cow_number': '1234567891',
        'shed_code': 'A001',
        'intake_date': date(2024, 1, 20),
        'gender': 'castrated',
        'origin_region': '曽於',
        'status': 'active'
    },
    # さらに多くのデータ...
]

# 一括作成
for cow_data in cows_data:
    Cow.objects.create(**cow_data)
```

### バルク作成（大量データの場合）

```python
from cattle.models import Cow
from datetime import date

cows_data = [
    Cow(
        cow_number='1234567890',
        shed_code='A001',
        intake_date=date(2024, 1, 15),
        gender='female',
        origin_region='北海道',
        status='active'
    ),
    Cow(
        cow_number='1234567891',
        shed_code='A001',
        intake_date=date(2024, 1, 20),
        gender='castrated',
        origin_region='曽於',
        status='active'
    ),
    # さらに多くのデータ...
]

# バルク作成（効率的）
Cow.objects.bulk_create(cows_data)
```

## 注意事項

1. **牛番号の重複**: 同じ牛番号が既に存在する場合、エラーになります（`--update`オプションを使用しない場合）

2. **日付形式**: 導入日は必ず `YYYY-MM-DD` 形式で入力してください

3. **文字エンコーディング**: CSVファイルはUTF-8で保存してください

4. **大量データ**: 大量のデータを登録する場合は、Django管理コマンドまたはプログラムでの一括登録を推奨します

5. **バックアップ**: 重要なデータを更新する前に、データベースのバックアップを取ることを推奨します

## トラブルシューティング

### よくあるエラー

1. **CSVファイルが見つからない**
   - ファイルパスが正しいか確認してください

2. **日付形式エラー**
   - 導入日が `YYYY-MM-DD` 形式になっているか確認してください

3. **牛番号が重複している**
   - `--update` オプションを使用するか、重複する牛番号を修正してください

4. **文字化け**
   - CSVファイルがUTF-8で保存されているか確認してください

### サポート
問題が発生した場合は、エラーメッセージを確認し、必要に応じて開発者に連絡してください。 